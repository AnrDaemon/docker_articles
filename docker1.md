Docker myths and receipts. Introduction.
========

Вокруг постоянно говорят про Docker. А, да, это что-то про контейнеры, виртуализацию, облака. У вас все и так работает. Это все баловство. Он не запустится на вашем старом ядре линукса. Точно так же можно подготовить образ для облака и запустить его. Можно просто настроить LXC, chroot или AppArmor. Вам он не нужен. Очередная модная штука. В конце концов, просто лень разобираться. 
Но любопытно! Тогда, читайте.

**Docker - это не виртуализация.**

Вот какой у меня линукс:
```
docker@dev:~$ uname -a
Linux dev 4.0.7-boot2docker #1 SMP Wed Jul 15 00:01:41 UTC 2015 x86_64 GNU/Linux
docker@dev:~$ free -h
              total        used        free      shared  buff/cache   available
Mem:           2.0G         43M        500M        106M        1.4G        1.6G
Swap:          1.4G          0B        1.4G
```
Запускаю убунту
```
docker@dev:~$ docker run -ti ubuntu
root@8d9f8ada3ce0:/# lsb_release -a
No LSB modules are available.
Distributor ID:	Ubuntu
Description:	Ubuntu 14.04.3 LTS
Release:	14.04
Codename:	trusty
root@8d9f8ada3ce0:/# uname -a
Linux 8d9f8ada3ce0 4.0.7-boot2docker #1 SMP Wed Jul 15 00:01:41 UTC 2015 x86_64 x86_64 x86_64 GNU/Linux
root@a24e29d3b492:/# free -h
             total       used       free     shared    buffers     cached
Mem:          2.0G       1.5G       491M       106M        47M       1.2G
-/+ buffers/cache:       202M       1.8G
Swap:         1.4G         0B       1.4G
```
То же ядро, та же память, а дистрибутив - другой.

Docker - это не chroot, их функционал частично совпадает. Это не система безопасности вроде AppArmor. Docker использует LXC как обертка, но интересен он не контейнерами. Docker - это ничего из того, что я думал о нем до того, как прочитал документацию.

**Docker - это инструмент объекто-ориентированного проектирования.**

Раньше регулярно возникали вопросы вроде того, является ли конфигурация nginx частью веб-приложения. Системные администраторы ругались с разработчиками.
Но недавно в мире появились devops и захотели вместо последовательно-функционального вызова команд из bash привычное OOP.
Docker нужен чтобы разделить всю информационную систему на слои (приложение, web-сервер, база данных, системные библиотеки, рабочие данные), связать все вместе, инжектить зависимости из конфигов, и заставить все это работает одной группой, одинаково на разных компьютерах.

Докер дает инкапсуляцию, наследование и полиморфизмом компонентам системы, таким как база данных и данные.

**Начало**
Итак, я открыл https://docs.docker.com/mac/started/, поставил Docker, выполнил несколько упражнений, и почувствовал, что меня держат за дурачка-двоечника, которого боятся перегрузить информацией.
Первый вопрос: куда это чертов докер поставился, где лежат его файлы, в каком формате, как оно все устроено?
Ответы здесь: http://blog.thoward37.me/articles/where-are-docker-images-stored/

Если вкратце, у Docker несколько драйверов для работы с файловой системой, обычно это AUFS, и все файлы контейнеров лежат в /var/lib/docker/aufs/diff/.
В /var/lib/docker/containers/ служебная информация, а не сами файлы контейнеров.

Изображения - это как классы в коде. Контейнеры - как объекты, созданные из классов. Только контейнер можно закомитить и сделать из него образ. 
Образы состоят из так называемых слоев, слои - это папки, которые лежат в /var/lib/docker/aufs/diff/. Обычно образы приложений наследуют какие-то готовые официальные системные образы. Когда Docker скачивает образ, ему нужны только те слои, которых у него нет.

Например, скачаю я официальный образ nginx: https://hub.docker.com/r/library/nginx/tags/
```
docker@dev:~$ docker pull nginx
latest: Pulling from nginx
aface2a79f55: Pull complete
5dd2638d10a1: Pull complete
97df1ddba09e: Pull complete
e7e7a55e9264: Pull complete
72b67c8ad0ca: Downloading [=============>                                     ] 883.6 kB/3.386 MB
9108e25be489: Download complete
6dda3f3a8c05: Download complete
42d2189f6cbe: Download complete
3cb7f49c6bc4: Download complete
a486da044a3f: Download complete
902b87aaaec9: Already exists
9a61b6b1315e: Already exists
```
Пишут, что у образа nginx 1.9.4 размер 52 мб, а качает он всего 3 мб, потому что Nginx собран на образе debian:jessie, который у меня "Already exists".
Есть много образов на базе ubuntu. Конечно, стоит собирать свою систему из образов с одним предком.

Теперь вы поймете документацию.